docker ve docker içim vm linleri

conda veya benzeri env mini conda

wsl activate 
Seçenek A: Hyper-V Etkinleştir (Windows Pro/Enterprise için)
Windows + R tuşlarına bas ve optionalfeatures yaz
Enter tuşuna bas
Hyper-V seçeneğini işaretle
Tamam tuşuna bas ve bilgisayarı yeniden başlat
# PowerShell'i yönetici olarak aç ve şu komutları çalıştır:
wsl --install
wsl --set-default-version 2


git bash ile start postgresql
chmod +x /start_postgres.sh
./start_postgres.sh

docker ps
docker exec -it postgres psql -U postgres -d trips_db


frukf@omer MINGW64 ~/Local/git/studycases/taxi-pipeline-case
$ docker ps
CONTAINER ID   IMAGE         COMMAND                  CREATED         STATUS         PORTS                                         NAMES
9cd8b9a3a95e   postgres:15   "docker-entrypoint.s…"   3 minutes ago   Up 3 minutes   0.0.0.0:5432->5432/tcp, [::]:5432->5432/tcp   postgres

frukf@omer MINGW64 ~/Local/git/studycases/taxi-pipeline-case
$ docker exec -it postgres psql -U postgres -d trips_db
psql (15.15 (Debian 15.15-1.pgdg13+1))
Type "help" for help.

trips_db=# \dt
Did not find any relations.
trips_db=# CREATE TABLE trips (
    trip_id VARCHAR(50) PRIMARY KEY,
    client_id VARCHAR(50) NOT NULL,
    driver_id VARCHAR(50) NOT NULL,
    trip_date TIMESTAMP NOT NULL,
    status VARCHAR(20) NOT NULL,
    CONSTRAINT status_check CHECK (status IN ('done', 'not_respond'))
);
CREATE TABLE
trips_db=# \dt
         List of relations
 Schema | Name  | Type  |  Owner
--------+-------+-------+----------
 public | trips | table | postgres
(1 row)


taxi-pipeline-case/
│
├── app/                         # FastAPI application
│   ├── main.py                  # API entrypoint
│   ├── db.py                    # PostgreSQL connection logic
│   ├── queries.py               # SQL queries
│   ├── schemas.py               # Response models (optional but clean)
│   └── __init__.py
│
├── ingestion/                   # Data ingestion scripts
│   ├── ingest_csv.py            # CSV → PostgreSQL loader
│   └── __init__.py
│
├── sql/
│   └── queries.sql              # Raw SQL queries (for review)
│
├── k8s/                         # Kubernetes manifests
│   ├── deployment.yaml
│   ├── service.yaml
│   ├── configmap.yaml
│   └── secret.yaml
│
├── data/
│   └── output.csv               # Provided dataset
│
├── Dockerfile                   # Multi-stage production Dockerfile
├── requirements.txt
├── README.md
└── .gitignore



trips_db=# \d trips
                           Table "public.trips"
  Column   |            Type             | Collation | Nullable | Default
-----------+-----------------------------+-----------+----------+---------
 trip_id   | character varying(50)       |           | not null |
 client_id | character varying(50)       |           | not null |
 driver_id | character varying(50)       |           | not null |
 trip_date | timestamp without time zone |           | not null |
 status    | character varying(20)       |           | not null |
Indexes:
    "trips_pkey" PRIMARY KEY, btree (trip_id)
    "idx_trips_client_id" btree (client_id)
    "idx_trips_driver_id" btree (driver_id)
    "idx_trips_trip_date" btree (trip_date)
Check constraints:
    "status_check" CHECK (status::text = ANY (ARRAY['done'::character varying, 'not_respond'::character varying]::text[]))



airflow dags list
airflow webserver -p 8080


airflow users create \
  --username admin \
  --password admin \
  --firstname Admin \
  --lastname User \
  --role Admin \
  --email admin@test.com


  docker start postgres
  docker stop postgres

  docker compose build
  docker compose up

  docker exec -it <container_name_or_id> bash


  airflow conn id ile posrgresql connections yada docker-compose.yml içine ekle


  conn_id fail fs_default fs_conn_id
  conn_type fs

airflow connections add postgres_trips \
  --conn-type postgres \
  --conn-host host.docker.internal \
  --conn-schema trips_db \
  --conn-login postgres \
  --conn-password postgres123 \
  --conn-port 5432


docker build -t trips-api .

kubectl apply -f k8s/secret.yaml
kubectl apply -f k8s/deployment.yaml
kubectl apply -f k8s/service.yaml


kubectl get pods
NAME                         READY   STATUS             RESTARTS   AGE
trips-api-74879b9bb5-6pfkb   0/1     ImagePullBackOff   0          28s
trips-api-74879b9bb5-st2xl   0/1     ImagePullBackOff   0          28s

kubectl logs <pod-ismi>

kubectl get svc
NAME         TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE
kubernetes   ClusterIP   10.96.0.1     <none>        443/TCP   12m
trips-api    ClusterIP   10.99.94.10   <none>        80/TCP    41s

kubectl get svc trips-api
NAME        TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE
trips-api   ClusterIP   10.99.94.10   <none>        80/TCP    56s


kubectl delete pod -l app=trips-api

kubectl delete deployment trips-api

kubectl apply -f k8s/deployment.yaml

kubectl port-forward svc/trips-api 8000:80

kubectl rollout restart deployment trips-api

docker images | grep trips-api
--trips-api:latest


hostname -I